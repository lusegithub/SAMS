<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <title>学生社团管理系统</title>
    <link rel="stylesheet" href="/webjars/bootstrap/3.3.5/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/static/css/common/bootstrapValidator.css"/>
    <script src="/webjars/jquery/3.1.1/jquery.min.js"></script>
    <script src="/webjars/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="/static/js/common/jQuery.Form.js"></script>
    <script src="/static/js/common/bootstrapValidator.js"></script>
    <script src="/static/js/common/header.js"></script>
</head>
<body>
<div id="header"></div>
<form id="myAdd" class="form-horizontal" role="form" style="padding: 30px 300px 10px;" enctype="multipart/form-data" th:action="@{/admin/association/add}" th:method="post">
    <fieldset>
        <legend>添加社团</legend>
    </fieldset>
    <div class="form-group">
        <label for="name" class="col-sm-2 control-label">社团全称：</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" id="name" name="name">
        </div>
    </div>

    <div class="form-group">
        <label for="logo" class="col-sm-2 control-label">logo：</label>
        <div class="col-sm-4">
            <input type="file" name="logoPic" id="logo">
        </div>
    </div>

    <div class="form-group">
        <label for="category" class="col-sm-2 control-label">类别：</label>
        <select class="col-lg-1 form-control" id="category" style="margin-left: 15px;width: 200px" name="category">
            <option value="">选择类别</option>
            <option value="人文学术">人文学术</option>
            <option value="文娱体育">文娱体育</option>
            <option value="社会服务">社会服务</option>
        </select>
    </div>

    <div class="form-group">
        <label for="purpose" class="col-sm-2 control-label">社团宗旨：</label>
        <textarea name="purpose" id="purpose" class="col-lg-3 input-sm" rows="3" style="margin-left: 15px"></textarea>
    </div>

    <div class="form-group">
        <label for="activity" class="col-sm-2 control-label">主要活动：</label>
        <textarea name="activity" id="activity" class="col-lg-3 input-sm" rows="3" style="margin-left: 15px"></textarea>
    </div>

    <div class="form-group">
        <label for="welfare" class="col-sm-2 control-label">会员福利：</label>
        <textarea name="welfare" id="welfare" class="col-lg-3 input-sm" rows="3" style="margin-left: 15px"></textarea>
    </div>

    <div class="form-group">
        <div class="col-sm-offset-2 col-sm-4">
            <button type="submit" class="btn btn-success" style="width: 100px">提交</button>
            <button type="button" class="btn" style="width: 100px;margin-left: 100px" onclick="back()">返回</button>
        </div>
    </div>
</form>
</body>
</html>
<script>

    $(document).ready(function() {
        $('#myAdd').bootstrapValidator({
            live: 'live',
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            submitButtons: 'button[type="submit"]',
            submitHandler: function(validator, form, submitButton) {
                // 实用ajax提交表单
                if (validator.isValid()) {
                    var options = {
                        success:  showResponse
                    };
                    $("#myAdd").ajaxSubmit(options);
                }
            },
            fields: {
                name: {
                    validators: {
                        notEmpty: {
                            message: "社团全称不能为空"
                        }
                    }
                },
                logoPic: {
                    validators: {
                        notEmpty: {
                            message: "上传一张图片"
                        }
                    }
                },
                category: {
                    validators: {
                        notEmpty: {
                            message: "请选择一个类别"
                        }
                    }
                }
            }
        });
        $('#myAdd').submit(function() {
            return false;
//            非常重要，如果是false，则表明是不跳转
//            在本页上处理，也就是ajax，如果是非false，则传统的form跳转。
        });
    });

    function showResponse(data) {
        if (data.resultCode === 0){
            alert(data.resultInfo);
            return
        }
        alert(data.resultInfo);
        window.location.href="/admin/association/listPage"
    }

    function back() {
        window.location.href="/admin/association/listPage"
    }
</script>